(()=>{const t=document.documentElement,e=t=>document.getElementById(t),n=t=>(t||"").toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"");function a(t,e=[]){const n=document.createElement("article");n.className="card";const a=o(t.title,e),r=o(t.excerpt,e);return n.innerHTML=`\n      <div class="meta">${t.date} • ${t.tags.join(", ")}</div>\n      <h3><a href="post.html?id=${encodeURIComponent(t.id)}">${a}</a></h3>\n      <p>${r}</p>\n      <a class="arrow" href="post.html?id=${encodeURIComponent(t.id)}">Lire →</a>\n    `,n}function o(t,e){if(!e.length)return t;const a=n(t),o=[];for(const t of e){let e=0;for(;;){const n=a.indexOf(t,e);if(-1===n)break;o.push({start:n,end:n+t.length}),e=n+t.length}}if(!o.length)return t;o.sort((t,e)=>t.start-e.start);const r=[];for(const t of o){const e=r[r.length-1];e&&t.start<e.end?e.end=Math.max(e.end,t.end):r.push({...t})}let s="",c=0;for(const e of r)s+=t.slice(c,e.start)+"<mark>"+t.slice(e.start,e.end)+"</mark>",c=e.end;return s+t.slice(c)}"light"===localStorage.getItem("theme")&&t.classList.add("light"),document.addEventListener("DOMContentLoaded",()=>{e("theme-toggle")?.addEventListener("click",()=>{t.classList.toggle("light"),localStorage.setItem("theme",t.classList.contains("light")?"light":"dark")}),async function(){const t=e("posts"),o=e("latest-posts");if(!t&&!o)return;const r=await fetch("posts.json"),s=await r.json(),c=new URLSearchParams(location.search).get("tag")||"",i=e("tag-filter"),l=e("search"),d=e("tag-pills"),p=e("result-count");if(i){const g=Array.from(new Set(s.flatMap(t=>t.tags))).sort();i.append(...g.map(t=>{const e=document.createElement("option");return e.value=t,e.textContent=t,e}))}if(d){const u=s.flatMap(t=>t.tags).reduce((t,e)=>(t[e]=(t[e]||0)+1,t),{});Object.entries(u).sort((t,e)=>e[1]-t[1]).slice(0,10).map(([t])=>t).forEach(t=>{const e=document.createElement("button");e.type="button",e.className="tag-pill"+(t===c?" active":""),e.dataset.tag=t,e.textContent=t,d.appendChild(e)})}o&&s.slice(0,3).forEach(t=>o.appendChild(a(t)));if(t){let f=1,L=9,v=c,E="",C=[];i&&(i.value=v);const y=e("load-more");function h(){d&&[...d.children].forEach(t=>t.classList.toggle("active",t.dataset.tag===v))}function m(){t.innerHTML="";const e=s.filter(t=>!v||t.tags.includes(v)).map(t=>{const e=n(t.title+" "+t.excerpt),a=C.reduce((t,n)=>t+(e.includes(n)?1:0),0);return{...t,score:a}}).filter(t=>!C.length||t.score>0).sort((t,e)=>C.length&&e.score!==t.score?e.score-t.score:new Date(e.date)-new Date(t.date));e.slice(0,f*L).forEach(e=>t.appendChild(a(e,C))),y.style.display=e.length>f*L?"inline-flex":"none",p&&(p.textContent=`${e.length} résultats`),h()}i?.addEventListener("change",t=>{v=t.target.value,f=1,m()}),d?.addEventListener("click",t=>{const e=t.target.closest(".tag-pill");e&&(v=e.dataset.tag,i&&(i.value=v),f=1,m())}),l?.addEventListener("input",t=>{E=t.target.value||"",C=n(E).split(/\s+/).filter(Boolean),f=1,m()}),y?.addEventListener("click",()=>{f++,m()}),m()}}(),async function(){if(!e("post-article"))return;const t=new URLSearchParams(location.search).get("id"),n=await(await fetch("posts.json")).json(),a=n.find(e=>e.id===t)||n[0];document.title=a.title+" — Robin",e("post-title").textContent=a.title;const o=e("post-meta"),r=e("post-cover");if(a.cover){const t=document.createElement("img");t.src=a.cover,t.loading="lazy",t.alt="",t.style.borderRadius="18px",t.style.width="100%",t.style.height="auto",r.innerHTML="",r.appendChild(t)}e("post-content").innerHTML=a.content.split("\n\n").map(t=>{if(t.startsWith("```")){const n=t.replace(/^```[a-z]*\n?|```$/g,"").replace(/```$/,"");return`<pre class="card"><code>${e=n,e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")}</code></pre>`}var e;return`<p>${t}</p>`}).join("");const s=((a.content||"").replace(/```[\s\S]*?```/g,"").match(/\S+/g)||[]).length,c=Math.max(1,Math.round(s/220));o&&(o.textContent=`${a.date} • ${a.tags.join(", ")} • ${c} min`);document.querySelectorAll("#post-content pre").forEach(t=>{const e=document.createElement("button");e.className="copy-btn",e.type="button",e.textContent="Copier",e.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(t.textContent),e.textContent="Copié !",setTimeout(()=>e.textContent="Copier",1200)}catch(t){}}),t.appendChild(e)});const i=e("read-progress");if(i){const t=e("post-article"),n=()=>{const e=t.scrollHeight-window.innerHeight,n=Math.min(Math.max(window.scrollY-t.offsetTop,0),e);i.style.width=(e>0?n/e*100:0).toFixed(2)+"%"};window.addEventListener("scroll",n,{passive:!0}),n()}const l=n.filter(t=>t.id!==a.id&&t.tags.some(t=>a.tags.includes(t))).slice(0,3),d=e("related");d.innerHTML="",l.forEach(t=>{const e=document.createElement("article");e.className="card",e.innerHTML=`<h3><a href="post.html?id=${encodeURIComponent(t.id)}">${t.title}</a></h3><p class="meta">${t.date} • ${t.tags.join(", ")}</p>`,d.appendChild(e)});const p={"@context":"https://schema.org","@type":"Article",headline:a.title,description:a.excerpt||a.title,datePublished:a.date,author:{"@type":"Person",name:"Robin"},mainEntityOfPage:location.href},h=e("ld-article");h&&(h.textContent=JSON.stringify(p,null,2))}(),function(){if(!("relList"in HTMLLinkElement.prototype)||!HTMLLinkElement.prototype.relList.supports?.("prefetch"))return;const t=t=>{try{return new URL(t,location.href).origin===location.origin}catch{return!1}};document.addEventListener("mouseover",e=>{const n=e.target.closest("a[href]");if(!n||!t(n.href))return;const a=document.createElement("link");a.rel="prefetch",a.href=n.href,a.as="document",document.head.appendChild(a)},{passive:!0})}(),"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js")})})();