(()=>{const t=document.documentElement,e=t=>document.getElementById(t),n=t=>(t||"").toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"");"light"===localStorage.getItem("theme")&&t.classList.add("light"),document.addEventListener("DOMContentLoaded",()=>{e("theme-toggle")?.addEventListener("click",()=>{t.classList.toggle("light"),localStorage.setItem("theme",t.classList.contains("light")?"light":"dark")}),function(){const t=e("menu-toggle"),n=document.querySelector(".menu");if(!t||!n)return;t.addEventListener("click",()=>{t.classList.toggle("open"),n.classList.toggle("open")})}(),function(){const t=e("scroll-progress");if(!t)return;const n=()=>{const e=document.body.scrollHeight-window.innerHeight,n=Math.min(window.scrollY,e);t.style.width=(e>0?n/e*100:0).toFixed(2)+"%"};window.addEventListener("scroll",n,{passive:!0}),n()}(),function(){const t=e("hero-bg");if(!t)return;const n=t.getContext("2d"),o=40,a=120,r=Array.from({length:o},()=>({x:Math.random()*t.clientWidth,y:Math.random()*t.clientHeight,vx:.5*(Math.random()-.5),vy:.5*(Math.random()-.5)}));function i(){t.width=t.clientWidth,t.height=t.clientHeight}function s(){n.clearRect(0,0,t.width,t.height);for(const e of r)e.x+=e.vx,e.y+=e.vy,(e.x<0||e.x>t.width)&&(e.vx*=-1),(e.y<0||e.y>t.height)&&(e.vy*=-1),n.beginPath(),n.arc(e.x,e.y,2,0,2*Math.PI),n.fillStyle="rgba(56,189,248,.4)",n.fill();for(let t=0;t<o;t++)for(let e=t+1;e<o;e++){const o=r[t],i=r[e],s=o.x-i.x,c=o.y-i.y,l=Math.hypot(s,c);l<a&&(n.strokeStyle=`rgba(56,189,248,${.3*(1-l/a)})`,n.beginPath(),n.moveTo(o.x,o.y),n.lineTo(i.x,i.y),n.stroke())}requestAnimationFrame(s)}window.addEventListener("resize",i),i(),s()}(),function(){const t=document.querySelectorAll("section");if(!t.length)return;const e=new IntersectionObserver(t=>{t.forEach(t=>t.isIntersecting&&t.target.classList.add("in-view"))},{threshold:.1});t.forEach(t=>e.observe(t))}(),function(){const t=document.querySelectorAll(".skill .bar span");if(!t.length)return;const e=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(t.target.style.width=t.target.dataset.level+"%",e.unobserve(t.target))})},{threshold:.5});t.forEach(t=>e.observe(t))}(),function(){const t=e("project-grid");if(!t)return;const n=document.querySelectorAll(".filter-btn"),o=e("project-modal"),r=e("modal-body"),i=o.querySelector(".modal-close"),s=[{title:"Pipeline scRNA-seq éducatif",category:"Génomique",img:"https://dummyimage.com/600x400/161b22/f1f5f9&text=scRNA",methodology:"De la QC au clustering avec Scanpy",stack:["Python","Scanpy"],results:"+40% de temps gagné",github:"#",demo:"#"},{title:"Exploration omique multimodale",category:"Bioinformatique",img:"https://dummyimage.com/600x400/161b22/f1f5f9&text=Omics",methodology:"Intégration transcriptome + image",stack:["Python","PyTorch"],results:"Proof of concept",github:"#",demo:"#"},{title:"Classifieur IA clinique",category:"IA",img:"https://dummyimage.com/600x400/161b22/f1f5f9&text=IA",methodology:"Modèle léger interprétable",stack:["Python","scikit-learn"],results:"AUC 0.92",github:"#",demo:"#"}];function c(e){t.innerHTML="",e.forEach(e=>{const n=document.createElement("article");n.className="card project-card",n.dataset.cat=e.category,n.innerHTML=`<img src="${e.img}" alt=""><h3>${e.title}</h3>`,n.addEventListener("click",()=>l(e)),t.appendChild(n)})}function l(t){r.innerHTML=`<h3>${t.title}</h3><p>${t.methodology}</p><div class="tags">${t.stack.map(t=>`<span class="tag" style="--color:${a(t)}">${t}</span>`).join(" ")}</div><p>${t.results}</p><p><a href="${t.github}">GitHub</a> • <a href="${t.demo}">Démo</a></p><img src="${t.img}" alt="">`,o.hidden=!1}i.addEventListener("click",()=>o.hidden=!0),o.addEventListener("click",t=>{t.target===o&&(o.hidden=!0)}),n.forEach(t=>t.addEventListener("click",()=>{n.forEach(t=>t.classList.remove("active")),t.classList.add("active");const e=t.dataset.cat;c("all"===e?s:s.filter(t=>t.category===e))})),c(s)}(),function(){const t=document.querySelectorAll(".timeline li");if(!t.length)return;const e=new IntersectionObserver(t=>{t.forEach(t=>t.target.classList.toggle("active",t.isIntersecting))},{threshold:.6});t.forEach(t=>e.observe(t))}(),async function(){const t=e("posts"),o=e("latest-posts");if(!t&&!o)return;t&&(t.innerHTML='<p class="meta">Chargement…</p>');const a=await fetch("posts.json"),i=await a.json(),s=new URLSearchParams(location.search).get("tag")||"",c=e("tag-filter"),l=e("search"),d=e("tag-pills"),h=e("result-count");if(c){const p=Array.from(new Set(i.flatMap(t=>t.tags))).sort();c.append(...p.map(t=>{const e=document.createElement("option");return e.value=t,e.textContent=t,e}))}if(d){const u=i.flatMap(t=>t.tags).reduce((t,e)=>(t[e]=(t[e]||0)+1,t),{});Object.entries(u).sort((t,e)=>e[1]-t[1]).slice(0,10).map(([t])=>t).forEach(t=>{const e=document.createElement("button");e.type="button",e.className="tag-pill"+(t===s?" active":""),e.dataset.tag=t,e.textContent=t,d.appendChild(e)})}o&&i.slice(0,3).forEach(t=>o.appendChild(r(t)));if(t){let f=1,y=9,v=s,L="",E=[];c&&(c.value=v);const x=e("load-more");function g(){d&&[...d.children].forEach(t=>t.classList.toggle("active",t.dataset.tag===v))}function m(){t.innerHTML="";const e=i.filter(t=>!v||t.tags.includes(v)).map(t=>{const e=n(t.title+" "+t.excerpt),o=E.reduce((t,n)=>t+(e.includes(n)?1:0),0);return{...t,score:o}}).filter(t=>!E.length||t.score>0).sort((t,e)=>E.length&&e.score!==t.score?e.score-t.score:new Date(e.date)-new Date(t.date));e.slice(0,f*y).forEach(e=>t.appendChild(r(e,E))),x.style.display=e.length>f*y?"inline-flex":"none",h&&(h.textContent=`${e.length} résultats`),g()}c?.addEventListener("change",t=>{v=t.target.value,f=1,m()}),d?.addEventListener("click",t=>{const e=t.target.closest(".tag-pill");e&&(v=e.dataset.tag,c&&(c.value=v),f=1,m())}),l?.addEventListener("input",t=>{L=t.target.value||"",E=n(L).split(/\s+/).filter(Boolean),f=1,m()}),x?.addEventListener("click",()=>{f++,m()}),m()}}(),async function(){if(!e("post-article"))return;const t=new URLSearchParams(location.search).get("id"),n=await(await fetch("posts.json")).json(),o=n.find(e=>e.id===t)||n[0];document.title=o.title+" — Robin",e("post-title").textContent=o.title;const a=e("post-meta"),r=e("post-cover");if(o.cover){const t=document.createElement("img");t.src=o.cover,t.loading="lazy",t.alt="",t.style.borderRadius="18px",t.style.width="100%",t.style.height="auto",r.innerHTML="",r.appendChild(t)}e("post-content").innerHTML=o.content.split("\n\n").map(t=>{if(t.startsWith("```")){const n=t.replace(/^```[a-z]*\n?|```$/g,"").replace(/```$/,"");return`<pre class="card"><code>${e=n,e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")}</code></pre>`}var e;return`<p>${t}</p>`}).join("");const i=((o.content||"").replace(/```[\s\S]*?```/g,"").match(/\S+/g)||[]).length,s=Math.max(1,Math.round(i/220));a&&(a.textContent=`${o.date} • ${o.tags.join(", ")} • ${s} min`);document.querySelectorAll("#post-content pre").forEach(t=>{const e=document.createElement("button");e.className="copy-btn",e.type="button",e.textContent="Copier",e.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(t.textContent),e.textContent="Copié !",setTimeout(()=>e.textContent="Copier",1200)}catch(t){}}),t.appendChild(e)});const c=e("read-progress");if(c){const t=e("post-article"),n=()=>{const e=t.scrollHeight-window.innerHeight,n=Math.min(Math.max(window.scrollY-t.offsetTop,0),e);c.style.width=(e>0?n/e*100:0).toFixed(2)+"%"};window.addEventListener("scroll",n,{passive:!0}),n()}const l=n.filter(t=>t.id!==o.id&&t.tags.some(t=>o.tags.includes(t))).slice(0,3),d=e("related");d.innerHTML="",l.forEach(t=>{const e=document.createElement("article");e.className="card",e.innerHTML=`<h3><a href="post.html?id=${encodeURIComponent(t.id)}">${t.title}</a></h3><p class="meta">${t.date} • ${t.tags.join(", ")}</p>`,d.appendChild(e)});const h={"@context":"https://schema.org","@type":"Article",headline:o.title,description:o.excerpt||o.title,datePublished:o.date,author:{"@type":"Person",name:"Robin"},mainEntityOfPage:location.href},g=e("ld-article");g&&(g.textContent=JSON.stringify(h,null,2))}(),function(){if(!("relList"in HTMLLinkElement.prototype)||!HTMLLinkElement.prototype.relList.supports?.("prefetch"))return;const t=t=>{try{return new URL(t,location.href).origin===location.origin}catch{return!1}};document.addEventListener("mouseover",e=>{const n=e.target.closest("a[href]");if(!n||!t(n.href))return;const o=document.createElement("link");o.rel="prefetch",o.href=n.href,o.as="document",document.head.appendChild(o)},{passive:!0})}(),"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js")});const o={};function a(t){if(!o[t]){const e=60*Object.keys(o).length%360;o[t]=`hsl(${e} 70% 50%)`}return o[t]}function r(t,e=[]){const n=document.createElement("article");n.className="card";const o=i(t.title,e),r=i(t.excerpt,e),s=(t.content||"").match(/\S+/g),c=Math.max(1,Math.round((s?s.length:0)/220)),l=t.tags.map(t=>`<span class="tag" style="--color:${a(t)}">${t}</span>`).join(" ");return n.innerHTML=`\n      <div class="meta">${t.date} • ${c} min</div>\n      <h3><a href="post.html?id=${encodeURIComponent(t.id)}">${o}</a></h3>\n      <p>${r}</p>\n      <div class="tags">${l}</div>\n      <a class="arrow" href="post.html?id=${encodeURIComponent(t.id)}">Lire →</a>\n    `,n}function i(t,e){if(!e.length)return t;const o=n(t),a=[];for(const t of e){let e=0;for(;;){const n=o.indexOf(t,e);if(-1===n)break;a.push({start:n,end:n+t.length}),e=n+t.length}}if(!a.length)return t;a.sort((t,e)=>t.start-e.start);const r=[];for(const t of a){const e=r[r.length-1];e&&t.start<e.end?e.end=Math.max(e.end,t.end):r.push({...t})}let i="",s=0;for(const e of r)i+=t.slice(s,e.start)+"<mark>"+t.slice(e.start,e.end)+"</mark>",s=e.end;return i+t.slice(s)}})();