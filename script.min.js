(()=>{const t=document.documentElement,e=t=>document.getElementById(t),n=t=>(t||"").toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"");function o(t,e=[]){const n=document.createElement("article");n.className="card";const o=r(t.title,e),a=r(t.excerpt,e);return n.innerHTML=`\n      <div class="meta">${t.date} • ${t.tags.join(", ")}</div>\n      <h3><a href="post.html?id=${encodeURIComponent(t.id)}">${o}</a></h3>\n      <p>${a}</p>\n      <a class="arrow" href="post.html?id=${encodeURIComponent(t.id)}">Lire →</a>\n    `,n}function r(t,e){if(!e.length)return t;const o=n(t),r=[];for(const t of e){let e=0;for(;;){const n=o.indexOf(t,e);if(-1===n)break;r.push({start:n,end:n+t.length}),e=n+t.length}}if(!r.length)return t;r.sort((t,e)=>t.start-e.start);const a=[];for(const t of r){const e=a[a.length-1];e&&t.start<e.end?e.end=Math.max(e.end,t.end):a.push({...t})}let i="",s=0;for(const e of a)i+=t.slice(s,e.start)+"<mark>"+t.slice(e.start,e.end)+"</mark>",s=e.end;return i+t.slice(s)}"light"===localStorage.getItem("theme")&&t.classList.add("light"),document.addEventListener("DOMContentLoaded",()=>{e("theme-toggle")?.addEventListener("click",()=>{t.classList.toggle("light"),localStorage.setItem("theme",t.classList.contains("light")?"light":"dark")}),function(){const t=e("menu-toggle"),n=document.querySelector(".menu");if(!t||!n)return;t.addEventListener("click",()=>{t.classList.toggle("open"),n.classList.toggle("open")})}(),function(){const t=e("scroll-progress");if(!t)return;const n=()=>{const e=document.body.scrollHeight-window.innerHeight,n=Math.min(window.scrollY,e);t.style.width=(e>0?n/e*100:0).toFixed(2)+"%"};window.addEventListener("scroll",n,{passive:!0}),n()}(),function(){const t=e("hero-bg");if(!t)return;const n=t.getContext("2d"),o=40,r=120,a=Array.from({length:o},()=>({x:Math.random()*t.clientWidth,y:Math.random()*t.clientHeight,vx:.5*(Math.random()-.5),vy:.5*(Math.random()-.5)}));function i(){t.width=t.clientWidth,t.height=t.clientHeight}function s(){n.clearRect(0,0,t.width,t.height);for(const e of a)e.x+=e.vx,e.y+=e.vy,(e.x<0||e.x>t.width)&&(e.vx*=-1),(e.y<0||e.y>t.height)&&(e.vy*=-1),n.beginPath(),n.arc(e.x,e.y,2,0,2*Math.PI),n.fillStyle="rgba(56,189,248,.4)",n.fill();for(let t=0;t<o;t++)for(let e=t+1;e<o;e++){const o=a[t],i=a[e],s=o.x-i.x,c=o.y-i.y,l=Math.hypot(s,c);l<r&&(n.strokeStyle=`rgba(56,189,248,${.3*(1-l/r)})`,n.beginPath(),n.moveTo(o.x,o.y),n.lineTo(i.x,i.y),n.stroke())}requestAnimationFrame(s)}window.addEventListener("resize",i),i(),s()}(),function(){const t=document.querySelectorAll("section");if(!t.length)return;const e=new IntersectionObserver(t=>{t.forEach(t=>t.isIntersecting&&t.target.classList.add("in-view"))},{threshold:.1});t.forEach(t=>e.observe(t))}(),async function(){const t=e("posts"),r=e("latest-posts");if(!t&&!r)return;const a=await fetch("posts.json"),i=await a.json(),s=new URLSearchParams(location.search).get("tag")||"",c=e("tag-filter"),l=e("search"),d=e("tag-pills"),h=e("result-count");if(c){const u=Array.from(new Set(i.flatMap(t=>t.tags))).sort();c.append(...u.map(t=>{const e=document.createElement("option");return e.value=t,e.textContent=t,e}))}if(d){const m=i.flatMap(t=>t.tags).reduce((t,e)=>(t[e]=(t[e]||0)+1,t),{});Object.entries(m).sort((t,e)=>e[1]-t[1]).slice(0,10).map(([t])=>t).forEach(t=>{const e=document.createElement("button");e.type="button",e.className="tag-pill"+(t===s?" active":""),e.dataset.tag=t,e.textContent=t,d.appendChild(e)})}r&&i.slice(0,3).forEach(t=>r.appendChild(o(t)));if(t){let f=1,v=9,y=s,w="",L=[];c&&(c.value=y);const x=e("load-more");function p(){d&&[...d.children].forEach(t=>t.classList.toggle("active",t.dataset.tag===y))}function g(){t.innerHTML="";const e=i.filter(t=>!y||t.tags.includes(y)).map(t=>{const e=n(t.title+" "+t.excerpt),o=L.reduce((t,n)=>t+(e.includes(n)?1:0),0);return{...t,score:o}}).filter(t=>!L.length||t.score>0).sort((t,e)=>L.length&&e.score!==t.score?e.score-t.score:new Date(e.date)-new Date(t.date));e.slice(0,f*v).forEach(e=>t.appendChild(o(e,L))),x.style.display=e.length>f*v?"inline-flex":"none",h&&(h.textContent=`${e.length} résultats`),p()}c?.addEventListener("change",t=>{y=t.target.value,f=1,g()}),d?.addEventListener("click",t=>{const e=t.target.closest(".tag-pill");e&&(y=e.dataset.tag,c&&(c.value=y),f=1,g())}),l?.addEventListener("input",t=>{w=t.target.value||"",L=n(w).split(/\s+/).filter(Boolean),f=1,g()}),x?.addEventListener("click",()=>{f++,g()}),g()}}(),async function(){if(!e("post-article"))return;const t=new URLSearchParams(location.search).get("id"),n=await(await fetch("posts.json")).json(),o=n.find(e=>e.id===t)||n[0];document.title=o.title+" — Robin",e("post-title").textContent=o.title;const r=e("post-meta"),a=e("post-cover");if(o.cover){const t=document.createElement("img");t.src=o.cover,t.loading="lazy",t.alt="",t.style.borderRadius="18px",t.style.width="100%",t.style.height="auto",a.innerHTML="",a.appendChild(t)}e("post-content").innerHTML=o.content.split("\n\n").map(t=>{if(t.startsWith("```")){const n=t.replace(/^```[a-z]*\n?|```$/g,"").replace(/```$/,"");return`<pre class="card"><code>${e=n,e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")}</code></pre>`}var e;return`<p>${t}</p>`}).join("");const i=((o.content||"").replace(/```[\s\S]*?```/g,"").match(/\S+/g)||[]).length,s=Math.max(1,Math.round(i/220));r&&(r.textContent=`${o.date} • ${o.tags.join(", ")} • ${s} min`);document.querySelectorAll("#post-content pre").forEach(t=>{const e=document.createElement("button");e.className="copy-btn",e.type="button",e.textContent="Copier",e.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(t.textContent),e.textContent="Copié !",setTimeout(()=>e.textContent="Copier",1200)}catch(t){}}),t.appendChild(e)});const c=e("read-progress");if(c){const t=e("post-article"),n=()=>{const e=t.scrollHeight-window.innerHeight,n=Math.min(Math.max(window.scrollY-t.offsetTop,0),e);c.style.width=(e>0?n/e*100:0).toFixed(2)+"%"};window.addEventListener("scroll",n,{passive:!0}),n()}const l=n.filter(t=>t.id!==o.id&&t.tags.some(t=>o.tags.includes(t))).slice(0,3),d=e("related");d.innerHTML="",l.forEach(t=>{const e=document.createElement("article");e.className="card",e.innerHTML=`<h3><a href="post.html?id=${encodeURIComponent(t.id)}">${t.title}</a></h3><p class="meta">${t.date} • ${t.tags.join(", ")}</p>`,d.appendChild(e)});const h={"@context":"https://schema.org","@type":"Article",headline:o.title,description:o.excerpt||o.title,datePublished:o.date,author:{"@type":"Person",name:"Robin"},mainEntityOfPage:location.href},p=e("ld-article");p&&(p.textContent=JSON.stringify(h,null,2))}(),function(){if(!("relList"in HTMLLinkElement.prototype)||!HTMLLinkElement.prototype.relList.supports?.("prefetch"))return;const t=t=>{try{return new URL(t,location.href).origin===location.origin}catch{return!1}};document.addEventListener("mouseover",e=>{const n=e.target.closest("a[href]");if(!n||!t(n.href))return;const o=document.createElement("link");o.rel="prefetch",o.href=n.href,o.as="document",document.head.appendChild(o)},{passive:!0})}(),"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js")})})();